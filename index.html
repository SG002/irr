<!DOCTYPE
html >
  <html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Irradiance Tracker</title>
    <style>
        :root {
            --primary-color: #2a9d8f;
            --secondary-color: #e9c46a;
            --background-color: #f8f9fa;
            --card-background: #ffffff;
            --text-color: #264653;
            --error-color: #e76f51;
            
            /* Status colors */
            --status-low: #e63946;
            --status-moderate: #f4a261;
            --status-high: #2a9d8f;
            --status-very-high: #2a9d8f;
            --status-optimal: #2a9d8f;
            --status-suboptimal: #f4a261;
            --status-poor: #e63946;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .subtitle {
            color: var(--text-color);
            font-weight: normal;
        }

        .form-container {
            background-color: var(--card-background);
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-control {
            flex: 1;
            min-width: 200px;
        }

        .form-control.full-width {
            width: 100%;
            flex-basis: 100%;
        }

        .coordinates-container {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .coordinates-display {
            background-color: rgba(42, 157, 143, 0.1);
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            display: none;
        }

        .coordinates-display.visible {
            display: block;
        }

        .tab-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            margin-right: 5px;
            background-color: #f1f1f1;
        }

        .tab.active {
            background-color: var(--card-background);
            border-color: #ddd;
            border-bottom-color: var(--card-background);
            margin-bottom: -1px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #238b7e;
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .error {
            color: var(--error-color);
            margin-top: 5px;
        }

        .results-container {
            display: none;
            background-color: var(--card-background);
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .results-card {
            margin-bottom: 20px;
        }

        .card-title {
            color: var(--primary-color);
            margin-bottom: 15px;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 8px;
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .data-item {
            padding: 15px;
            background-color: rgba(233, 196, 106, 0.1);
            border-radius: 6px;
        }

        .data-label {
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .data-value {
            font-size: 18px;
            margin-bottom: 10px;
        }

        /* New styles for status indicators */
        .status-badge {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            display: inline-block;
        }

        .status-low {
            background-color: var(--status-low);
        }

        .status-moderate {
            background-color: var(--status-moderate);
        }

        .status-high {
            background-color: var(--status-high);
        }

        .status-very-high {
            background-color: var(--status-very-high);
        }

        .status-optimal {
            background-color: var(--status-optimal);
        }

        .status-suboptimal {
            background-color: var(--status-suboptimal);
        }

        .status-poor {
            background-color: var(--status-poor);
        }

        /* Gauge styles */
        .gauge-container {
            position: relative;
            height: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .gauge-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease-in-out;
        }

        .gauge-markers {
            position: relative;
            height: 15px;
            margin-bottom: 10px;
        }

        .gauge-marker {
            position: absolute;
            width: 2px;
            height: 8px;
            background-color: #adb5bd;
            top: 0;
        }

        .gauge-marker-label {
            position: absolute;
            font-size: 10px;
            color: #6c757d;
            top: 8px;
            transform: translateX(-50%);
        }

        .constraints-info {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
            font-style: italic;
        }

        /* Info icon and tooltip styles */
        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            font-size: 12px;
            font-weight: bold;
            cursor: help;
            margin-left: 8px;
            position: relative;
        }

        .tooltip {
            visibility: hidden;
            position: absolute;
            width: 300px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-weight: normal;
            font-style: normal;
            font-size: 12px;
            line-height: 1.4;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .info-icon:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }

        .spinner {
            display: none;
            width: 40px;
            height: 40px;
            margin: 20px auto;
            border: 4px solid rgba(42, 157, 143, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        footer {
            text-align: center;
            margin-top: 40px;
            color: #666;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .form-control {
                min-width: 100%;
            }
            
            .coordinates-container {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Solar Irradiance Tracker</h1>
            <p class="subtitle">Get accurate solar irradiance data for any location on Earth</p>
        </header>

        <div class="form-container">
            <h2>Enter Location</h2>
            <p>Search for a location or enter coordinates to fetch solar irradiance data.</p>
            
            <div class="tab-container">
                <div class="tab active" data-tab="location-search">Search by Location</div>
                <div class="tab" data-tab="coordinates">Enter Coordinates</div>
            </div>
            
            <form id="solarDataForm" novalidate>
                <div id="location-search" class="tab-content active">
                    <div class="form-control full-width">
                        <label for="locationInput">Location</label>
                        <input type="text" id="locationInput" name="location" placeholder="Enter city, address, or place (e.g., New York, USA)" required>
                        <div id="locationError" class="error"></div>
                    </div>
                    
                    <div id="coordinatesDisplay" class="coordinates-display">
                        <p>Selected coordinates: <span id="displayLat"></span>, <span id="displayLng"></span></p>
                    </div>
                </div>
                
                <div id="coordinates" class="tab-content">
                    <div class="coordinates-container">
                        <div class="form-control">
                            <label for="latitude">Latitude</label>
                            <input type="number" id="latitude" name="latitude" step="0.000001" placeholder="e.g., 40.7128">
                            <div id="latitudeError" class="error"></div>
                        </div>
                        <div class="form-control">
                            <label for="longitude">Longitude</label>
                            <input type="number" id="longitude" name="longitude" step="0.000001" placeholder="e.g., -74.0060">
                            <div id="longitudeError" class="error"></div>
                        </div>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="form-control">
                        <label for="startDate">Start Date</label>
                        <input type="date" id="startDate" name="startDate" required>
                        <div id="startDateError" class="error"></div>
                    </div>
                    <div class="form-control">
                        <label for="endDate">End Date</label>
                        <input type="date" id="endDate" name="endDate" required>
                        <div id="endDateError" class="error"></div>
                    </div>
                </div>
                
                <button type="submit" id="fetchButton">Fetch Irradiance Data</button>
            </form>
        </div>

        <div id="spinner" class="spinner"></div>

        <div id="resultsContainer" class="results-container">
            <div class="results-card">
                <h2 class="card-title">Solar Irradiance Results</h2>
                <div class="data-grid" id="irradianceData">
                    
                </div>
            </div>

            <div class="results-card">
                <h2 class="card-title">Location Information</h2>
                <div class="data-grid" id="locationData">
                    
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>Solar Irradiance data provided by NASA POWER API | Geocoding by OpenStreetMap Nominatim</p>
    </footer>

    <script>
        
        const form = document.getElementById('solarDataForm');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const locationInput = document.getElementById('locationInput');
        const latitudeInput = document.getElementById('latitude');
        const longitudeInput = document.getElementById('longitude');
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const locationError = document.getElementById('locationError');
        const latitudeError = document.getElementById('latitudeError');
        const longitudeError = document.getElementById('longitudeError');
        const startDateError = document.getElementById('startDateError');
        const endDateError = document.getElementById('endDateError');
        const fetchButton = document.getElementById('fetchButton');
        const spinner = document.getElementById('spinner');
        const resultsContainer = document.getElementById('resultsContainer');
        const irradianceDataContainer = document.getElementById('irradianceData');
        const locationDataContainer = document.getElementById('locationData');
        const coordinatesDisplay = document.getElementById('coordinatesDisplay');
        const displayLat = document.getElementById('displayLat');
        const displayLng = document.getElementById('displayLng');

        
        const constraints = {
            solarIrradiance: {
                low: { max: 2.6, label: 'Low', color: 'var(--status-low)' },
                moderate: { min: 2.6, max: 3, label: 'Moderate', color: 'var(--status-moderate)' },
                high: { min: 3, max: 4, label: 'High', color: 'var(--status-high)' },
                veryHigh: { min: 4, label: 'Optimal', color: 'var(--status-very-high)' }
            },
            clearnessIndex: {
                poor: { max: 0.25, label: 'Poor', color: 'var(--status-poor)' },
                suboptimal: { min: 0.25, max: 0.5, label: 'Suboptimal', color: 'var(--status-suboptimal)' },
                optimal: { min: 0.5, max: 0.75, label: 'Optimal', color: 'var(--status-optimal)' },
                extreme: { min: 0.75, label: 'Extreme', color: 'var(--status-very-high)' }
            },
            temperature: {
                cold: { max: 15, label: 'Cold', color: 'var(--status-low)' },
                cool: { min: 15, max: 20, label: 'Cool', color: 'var(--status-suboptimal)' },
                optimal: { min: 20, max: 30, label: 'Optimal', color: 'var(--status-optimal)' },
                hot: { min: 30, label: 'Hot', color: 'var(--status-high)' }
            },
            windSpeed: {
                low: { max: 3, label: 'Low', color: 'var(--status-low)' },
                moderate: { min: 3, max: 6, label: 'Moderate', color: 'var(--status-moderate)' },
                high: { min: 6, max: 100, label: 'High', color: 'var(--status-high)' }
            }
        };

        
        const currentYear = new Date().getFullYear();
        startDateInput.value = `${currentYear}-01-01`;
        endDateInput.value = `${currentYear}-12-31`;

        
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
                
                clearErrors();
            });
        });

        function clearErrors() {
            locationError.textContent = '';
            latitudeError.textContent = '';
            longitudeError.textContent = '';
            startDateError.textContent = '';
            endDateError.textContent = '';
        }

        async function geocodeLocation(locationName) {
            try {
                spinner.style.display = 'block';
                fetchButton.disabled = true;
                
                const encodedLocation = encodeURIComponent(locationName);
                const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodedLocation}&limit=1`;
                
                const response = await fetch(url, {
                    headers: {
                        'Accept': 'application/json',
                        'User-Agent': 'SolarIrradianceTracker/1.0' // Nominatim requires a User-Agent
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`Geocoding failed with status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (!data || data.length === 0) {
                    throw new Error('Location not found. Please try a different location name.');
                }
                
                const result = data[0];
                return {
                    latitude: parseFloat(result.lat),
                    longitude: parseFloat(result.lon),
                    displayName: result.display_name
                };
            } catch (error) {
                throw error;
            } finally {
                
                spinner.style.display = 'none';
                fetchButton.disabled = false;
            }
        }

        function validateForm() {
            let isValid = true;
            clearErrors();
            
            
            const activeTab = document.querySelector('.tab.active').getAttribute('data-tab');
            
            if (activeTab === 'location-search') {
                
                if (!locationInput.value.trim()) {
                    locationError.textContent = 'Please enter a location';
                    isValid = false;
                }
            } else if (activeTab === 'coordinates') {
              
                const lat = parseFloat(latitudeInput.value);
                if (isNaN(lat) || lat < -90 || lat > 90) {
                    latitudeError.textContent = 'Latitude must be between -90 and 90';
                    isValid = false;
                }
                
                const lng = parseFloat(longitudeInput.value);
                if (isNaN(lng) || lng < -180 || lng > 180) {
                    longitudeError.textContent = 'Longitude must be between -180 and 180';
                    isValid = false;
                }
            }
            
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);
            
            if (isNaN(startDate.getTime())) {
                startDateError.textContent = 'Please enter a valid start date';
                isValid = false;
            }
            
            if (isNaN(endDate.getTime())) {
                endDateError.textContent = 'Please enter a valid end date';
                isValid = false;
            } else if (endDate < startDate) {
                endDateError.textContent = 'End date must be after start date';
                isValid = false;
            }
            
            
            const oneYearInMs = 365 * 24 * 60 * 60 * 1000;
            if (endDate - startDate > oneYearInMs) {
                endDateError.textContent = 'Date range cannot exceed 1 year';
                isValid = false;
            }
            
            return isValid;
        }


        function formatDateForAPI(dateString) {
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}${month}${day}`;
        }

        // NASA POWER API Data Fetching
        async function fetchSolarIrradianceData(latitude, longitude, startDate, endDate) {
            // NASA POWER API parameters
            const parameters = [
                'ALLSKY_SFC_SW_DWN', 
                'ALLSKY_SFC_PAR_TOT', 
                'ALLSKY_KT',
                'T2M', 
                'WS2M' 
            ];
            
            const formattedStartDate = formatDateForAPI(startDate);
            const formattedEndDate = formatDateForAPI(endDate);
            
            
            const url = `https://power.larc.nasa.gov/api/temporal/daily/point?parameters=${parameters.join(',')}&community=RE&longitude=${longitude}&latitude=${latitude}&start=${formattedStartDate}&end=${formattedEndDate}&format=JSON`;
            
            try {
            
                spinner.style.display = 'block';
                fetchButton.disabled = true;
                
               
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`NASA POWER API returned status: ${response.status}`);
                }
                
                const data = await response.json();
                return data;
            } catch (error) {
                throw new Error(`Failed to fetch data: ${error.message}`);
            } finally {
                
                spinner.style.display = 'none';
                fetchButton.disabled = false;
            }
        }

      
        function processMonthlyData(parameterObj) {
            const monthlyData = {};
            
            for (let month = 1; month <= 12; month++) {
                const monthKey = month.toString().padStart(2, '0');
                monthlyData[monthKey] = { total: 0, count: 0 };
            }
            
            for (const dateKey in parameterObj) {
                const month = dateKey.substring(4, 6); 
                const value = parameterObj[dateKey];
                
                if (!isNaN(value)) {
                    monthlyData[month].total += value;
                    monthlyData[month].count++;
                }
            }
            
            
            const monthlyAverages = {};
            for (const month in monthlyData) {
                if (monthlyData[month].count > 0) {
                    monthlyAverages[month] = monthlyData[month].total / monthlyData[month].count;
                }
            }
            
            return monthlyAverages;
        }

        
        function getValueStatus(value, constraintType) {
            const typeConstraints = constraints[constraintType];
            
            for (const status in typeConstraints) {
                const constraint = typeConstraints[status];
                
                if (constraint.hasOwnProperty('min') && constraint.hasOwnProperty('max')) {
                    if (value >= constraint.min && value < constraint.max) {
                        return constraint;
                    }
                } else if (constraint.hasOwnProperty('min')) {
                    if (value >= constraint.min) {
                        return constraint;
                    }
                } else if (constraint.hasOwnProperty('max')) {
                    if (value < constraint.max) {
                        return constraint;
                    }
                }
            }
            
           
            return { label: 'Unknown', color: '#6c757d' };
        }

        
        function createGauge(value, constraintType, min, max) {
            const container = document.createElement('div');
            
            
            const gaugeContainer = document.createElement('div');
            gaugeContainer.className = 'gauge-container';
            
           
            const gaugeFill = document.createElement('div');
            gaugeFill.className = 'gauge-fill';
            
            
            const percentage = Math.min(100, Math.max(0, ((value - min) / (max - min)) * 100));
            gaugeFill.style.width = `${percentage}%`;
            
           
            const status = getValueStatus(value, constraintType);
            gaugeFill.style.backgroundColor = status.color;
            
            gaugeContainer.appendChild(gaugeFill);
            container.appendChild(gaugeContainer);
            
            const gaugeMarkers = document.createElement('div');
            gaugeMarkers.className = 'gauge-markers';
       
            const typeConstraints = constraints[constraintType];
         
            const minMarker = document.createElement('div');
            minMarker.className = 'gauge-marker';
            minMarker.style.left = '0%';
            
            const minLabel = document.createElement('div');
            minLabel.className = 'gauge-marker-label';
            minLabel.style.left = '0%';
            minLabel.textContent = min;
            
            gaugeMarkers.appendChild(minMarker);
            gaugeMarkers.appendChild(minLabel);
            
            // Add constraint threshold markers
            for (const status in typeConstraints) {
                const constraint = typeConstraints[status];
                
                if (constraint.hasOwnProperty('min') && constraint.min > min && constraint.min < max) {
                    const percentage = ((constraint.min - min) / (max - min)) * 100;
                    
                    const marker = document.createElement('div');
                    marker.className = 'gauge-marker';
                    marker.style.left = `${percentage}%`;
                    
                    const label = document.createElement('div');
                    label.className = 'gauge-marker-label';
                    label.style.left = `${percentage}%`;
                    label.textContent = constraint.min;
                    
                    gaugeMarkers.appendChild(marker);
                    gaugeMarkers.appendChild(label);
                }
            }
            
            // Add max marker
            const maxMarker = document.createElement('div');
            maxMarker.className = 'gauge-marker';
            maxMarker.style.left = '100%';
            
            const maxLabel = document.createElement('div');
            maxLabel.className = 'gauge-marker-label';
            maxLabel.style.left = '100%';
            maxLabel.textContent = max;
            
            gaugeMarkers.appendChild(maxMarker);
            gaugeMarkers.appendChild(maxLabel);
            
            container.appendChild(gaugeMarkers);
            
            return container;
        }

        // Create constraints info text
        function createConstraintsInfo(constraintType) {
            const container = document.createElement('div');
            container.className = 'constraints-info';
            
            let infoText = '';
            
            switch(constraintType) {
                case 'solarIrradiance':
                    infoText = 'Low: <2.6 | Moderate: 2.6-3 | High: 3-4 | Optimal: >4 kWh/m²';
                    break;
                case 'clearnessIndex':
                    infoText = 'Poor: <0.25 | Suboptimal: 0.25-0.5 | Optimal: 0.5-0.75 | Extreme: >0.75';
                    break;
                case 'temperature':
                    infoText = 'Optimal temperature is close to 25°C';
                    break;
                case 'windSpeed':
                    infoText = 'Low: <3 | Moderate: 3-6 | High: >6 m/s';
                    break;
            }
            
            container.textContent = infoText;
            return container;
        }

        // Helper function to add a data item to the container
        function addDataItem(container, label, value, tooltip = null) {
            const dataItem = document.createElement('div');
            dataItem.className = 'data-item';
            
            const dataLabel = document.createElement('div');
            dataLabel.className = 'data-label';
            
            // Create label text
            const labelText = document.createElement('span');
            labelText.textContent = label;
            dataLabel.appendChild(labelText);
            
            // Add info icon with tooltip if provided
            if (tooltip) {
                const infoIcon = document.createElement('div');
                infoIcon.className = 'info-icon';
                infoIcon.textContent = 'i';
                
                const tooltipElement = document.createElement('div');
                tooltipElement.className = 'tooltip';
                tooltipElement.textContent = tooltip;
                
                infoIcon.appendChild(tooltipElement);
                dataLabel.appendChild(infoIcon);
            }
            
            const dataValue = document.createElement('div');
            dataValue.className = 'data-value';
            dataValue.textContent = value;
            
            dataItem.appendChild(dataLabel);
            dataItem.appendChild(dataValue);
            container.appendChild(dataItem);
        }

        // Helper function to add a data item with status indicator and gauge
        function addDataItemWithStatus(container, label, displayValue, value, constraintType, min, max, tooltip = null) {
            const dataItem = document.createElement('div');
            dataItem.className = 'data-item';
            
            // Create label with status badge
            const dataLabel = document.createElement('div');
            dataLabel.className = 'data-label';
            
            const labelText = document.createElement('span');
            labelText.textContent = label;
            dataLabel.appendChild(labelText);
            
            // Add info icon with tooltip if provided
            if (tooltip) {
                const infoIcon = document.createElement('div');
                infoIcon.className = 'info-icon';
                infoIcon.textContent = 'i';
                
                const tooltipElement = document.createElement('div');
                tooltipElement.className = 'tooltip';
                tooltipElement.textContent = tooltip;
                
                infoIcon.appendChild(tooltipElement);
                dataLabel.appendChild(infoIcon);
            }
            
            // Get status and create badge
            const status = getValueStatus(value, constraintType);
            const statusBadge = document.createElement('span');
            statusBadge.className = `status-badge`;
            statusBadge.textContent = status.label;
            statusBadge.style.backgroundColor = status.color;
            dataLabel.appendChild(statusBadge);
            
            // Create value display
            const dataValue = document.createElement('div');
            dataValue.className = 'data-value';
            dataValue.textContent = displayValue;
            
            // Create gauge
            const gauge = createGauge(value, constraintType, min, max);
            
            // Create constraints info
            const constraintsInfo = createConstraintsInfo(constraintType);
            
            // Append all elements
            dataItem.appendChild(dataLabel);
            dataItem.appendChild(dataValue);
            dataItem.appendChild(gauge);
            dataItem.appendChild(constraintsInfo);
            
            container.appendChild(dataItem);
        }

        // Display Results
        function displayResults(data, latitude, longitude, locationName, startDate, endDate) {
            // Clear previous results
            irradianceDataContainer.innerHTML = '';
            locationDataContainer.innerHTML = '';
            
            // Extract parameters data
            const parameters = data.properties.parameter;
            
            // Calculate averages
            const avgIrradiance = calculateAverage(parameters.ALLSKY_SFC_SW_DWN);
            const avgPAR = calculateAverage(parameters.ALLSKY_SFC_PAR_TOT);
            const avgClearness = calculateAverage(parameters.ALLSKY_KT);
            const avgTemperature = calculateAverage(parameters.T2M);
            const avgWindSpeed = calculateAverage(parameters.WS2M);
            
            // Tooltip definitions
            const irradianceTooltip = "Optimal Values: Regions with average daily solar irradiance of 5 kWh/m² or higher are considered excellent for solar energy projects. This value corresponds to approximately 5 Peak Sun Hours (PSH), indicating the number of equivalent hours per day when solar insolation is at its peak level of 1 kW/m².";
            const parTooltip = "Relevance to Solar Projects: PAR measurements are more pertinent to agricultural assessments. For solar energy projects, Global Horizontal Irradiance (GHI) is the more relevant metric.";
            const clearnessTooltip = "Optimal Values: The monthly average clearness index (Kt) typically ranges from 0.25 (very cloudy conditions) to 0.75 (very clear conditions). Values closer to 0.75 are ideal for solar projects, as they indicate clearer skies and higher solar radiation availability.";
            const temperatureTooltip = "Optimal Conditions: Moderate temperatures are preferable. Extremely high temperatures can reduce panel efficiency, while very low temperatures can enhance performance but may introduce other operational challenges.";
            const windSpeedTooltip = "Optimal Conditions: Locations with moderate wind speeds are ideal, balancing the cooling benefits without introducing significant structural risks.";
            
            // Add irradiance data items with status indicators, gauges, and tooltips
            addDataItemWithStatus(irradianceDataContainer, 'Avg. Solar Irradiance', `${avgIrradiance.toFixed(2)} kWh/m²/day`, avgIrradiance, 'solarIrradiance', 0, 6, irradianceTooltip);
            addDataItem(irradianceDataContainer, 'Avg. PAR', `${avgPAR.toFixed(2)} MJ/m²/day`, parTooltip);
            addDataItemWithStatus(irradianceDataContainer, 'Avg. Clearness Index', avgClearness.toFixed(2), avgClearness, 'clearnessIndex', 0, 1, clearnessTooltip);
            addDataItemWithStatus(irradianceDataContainer, 'Avg. Temperature', `${avgTemperature.toFixed(1)} °C`, avgTemperature, 'temperature', 0, 40, temperatureTooltip);
            addDataItemWithStatus(irradianceDataContainer, 'Avg. Wind Speed', `${avgWindSpeed.toFixed(1)} m/s`, avgWindSpeed, 'windSpeed', 0, 10, windSpeedTooltip);
            
            // Process monthly data
            const monthlyIrradiance = processMonthlyData(parameters.ALLSKY_SFC_SW_DWN);
            
            // Add monthly data for irradiance (without tooltips for monthly data)
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            monthNames.forEach((monthName, index) => {
                const monthKey = (index + 1).toString().padStart(2, '0');
                if (monthlyIrradiance[monthKey]) {
                    const value = monthlyIrradiance[monthKey];
                    addDataItemWithStatus(
                        irradianceDataContainer, 
                        `${monthName} Irradiance`, 
                        `${value.toFixed(2)} kWh/m²/day`,
                        value,
                        'solarIrradiance',
                        0,
                        6
                    );
                }
            });
            
            // Location information
            if (locationName) {
                addDataItem(locationDataContainer, 'Location', locationName);
            }
            addDataItem(locationDataContainer, 'Latitude', `${Number.parseFloat(latitude).toFixed(6)}°`);
            addDataItem(locationDataContainer, 'Longitude', `${Number.parseFloat(longitude).toFixed(6)}°`);
            
            // Format dates for display
            const formattedStartDate = new Date(startDate).toLocaleDateString();
            const formattedEndDate = new Date(endDate).toLocaleDateString();
            
            addDataItem(locationDataContainer, 'Data Source', 'NASA POWER API');
            addDataItem(locationDataContainer, 'Data Period', `${formattedStartDate} - ${formattedEndDate}`);
            
            // Show results container
            resultsContainer.style.display = 'block';
        }

        // Helper function to calculate average from a parameter object
        function calculateAverage(parameterObj) {
            const values = Object.values(parameterObj).filter(value => !isNaN(value));
            return values.length > 0 ? values.reduce((sum, value) => sum + value, 0) / values.length : 0;
        }

        // Location input event handler - geocode on blur
        locationInput.addEventListener('blur', async () => {
            const location = locationInput.value.trim();
            if (location) {
                try {
                    const geocodeResult = await geocodeLocation(location);
                    
                    // Display the coordinates
                    displayLat.textContent = geocodeResult.latitude.toFixed(6);
                    displayLng.textContent = geocodeResult.longitude.toFixed(6);
                    coordinatesDisplay.classList.add('visible');
                    
                    // Update hidden inputs
                    latitudeInput.value = geocodeResult.latitude;
                    longitudeInput.value = geocodeResult.longitude;
                } catch (error) {
                    locationError.textContent = error.message;
                    coordinatesDisplay.classList.remove('visible');
                }
            }
        });

        // Form Submit Handler
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!validateForm()) {
                return;
            }
            
            const activeTab = document.querySelector('.tab.active').getAttribute('data-tab');
            let latitude, longitude, locationName;
            
            try {
                if (activeTab === 'location-search') {
                    const location = locationInput.value.trim();
                    
                    // Check if we already have coordinates from the blur event
                    if (coordinatesDisplay.classList.contains('visible')) {
                        latitude = Number.parseFloat(displayLat.textContent);
                        longitude = parseFloat(displayLng.textContent);
                        locationName = location;
                    } else {
                        // Geocode the location
                        const geocodeResult = await geocodeLocation(location);
                        latitude = geocodeResult.latitude;
                        longitude = geocodeResult.longitude;
                        locationName = geocodeResult.displayName;
                        
                        // Update the display
                        displayLat.textContent = latitude.toFixed(6);
                        displayLng.textContent = longitude.toFixed(6);
                        coordinatesDisplay.classList.add('visible');
                    }
                } else {
                    // Get coordinates directly from inputs
                    latitude = Number.parseFloat(latitudeInput.value.trim());
                    longitude = parseFloat(longitudeInput.value.trim());
                }
                
                const startDate = startDateInput.value;
                const endDate = endDateInput.value;
                
                const data = await fetchSolarIrradianceData(latitude, longitude, startDate, endDate);
                displayResults(data, latitude, longitude, locationName, startDate, endDate);
            } catch (error) {
                alert(`Error: ${error.message}`);
                console.error(error);
            }
        });
    </script>
</body>
</html>

